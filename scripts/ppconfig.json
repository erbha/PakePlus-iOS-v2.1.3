{"name":"dbaceabfeffd","url":"http://mail2.83oouu.top:39221/","showName":"Omnibox","appid":"com.dbaceabfeffd.app","icon":"","iconPath":"C:\\Users\\Administrator\\AppData\\Roaming\\com.pakeplus.pacbao\\dbaceabfeffd.png","iconRound":true,"state":true,"single":true,"injectJq":true,"tauriApi":false,"devbug":false,"version":"0.0.2","preview":"Android","platform":["1-1","2-2"],"width":412,"height":915,"desc":"","jsFile":[],"filterCss":"","customJs":"/**\n * 安卓平台链接行为控制优化版\n * 保留核心功能，提升性能和兼容性\n * 新增手势识别功能：\n * - 左右滑动拉动进度条\n * - 右边屏幕上下滑动调整音量\n * - 左边屏幕上下滑动调整亮度\n */\n(function() {\n    'use strict';\n\n    // 缓存base标签查询结果\n    let baseTargetBlank = null;\n    \n    // 特性检测\n    const supportsClosest = typeof Element.prototype.closest === 'function';\n    const isAndroid = /android/i.test(navigator.userAgent);\n    \n    // 手势识别相关变量\n    let gestureStartX = 0;\n    let gestureStartY = 0;\n    let gestureStartTime = 0;\n    let isDragging = false;\n    let gestureThreshold = 50; // 手势识别阈值（像素）\n    let timeThreshold = 300; // 时间阈值（毫秒）\n    \n    // 进度条控制相关\n    let progressBar = null;\n    let progressContainer = null;\n    \n    // 初始化缓存\n    function initCache() {\n        if (!baseTargetBlank) {\n            baseTargetBlank = document.querySelector('head base[target=\"_blank\"]');\n        }\n    }\n\n    /**\n     * 获取最近的a标签（兼容处理）\n     */\n    function getClosestAnchor(element) {\n        if (supportsClosest) {\n            return element.closest('a');\n        }\n        \n        // 兼容不支持closest的浏览器\n        let el = element;\n        while (el && el.nodeType === 1) {\n            if (el.tagName === 'A') {\n                return el;\n            }\n            el = el.parentNode;\n        }\n        return null;\n    }\n\n    /**\n     * 点击事件处理函数\n     */\n    const hookClick = (e) => {\n        // 性能优化：快速检查是否可能是链接点击\n        if (e.target.tagName !== 'A' && !e.target.closest('a')) {\n            return;\n        }\n\n        const origin = getClosestAnchor(e.target);\n        \n        // 初始化缓存（延迟加载）\n        initCache();\n\n        // 检查是否需要处理\n        const shouldHandle = origin && origin.href && (\n            origin.target === '_blank' || \n            (baseTargetBlank && !origin.target)\n        );\n\n        if (shouldHandle) {\n            // 允许用户通过Ctrl/Command+点击在新窗口打开\n            if (e.ctrlKey || e.metaKey) {\n                return;\n            }\n\n            e.preventDefault();\n            \n            try {\n                // 验证URL有效性\n                const url = new URL(origin.href);\n                \n                // 安卓特殊处理：检查是否为下载链接\n                if (isDownloadLink(url, origin)) {\n                    return; // 下载链接不拦截\n                }\n\n                // 安卓WebView特殊处理\n                if (isAndroid && window.Android) {\n                    // 如果有原生交互接口，优先使用\n                    if (typeof window.Android.openUrl === 'function') {\n                        window.Android.openUrl(origin.href);\n                        return;\n                    }\n                }\n\n                // 正常跳转\n                location.href = origin.href;\n                \n            } catch (error) {\n                console.error('Invalid URL:', origin.href, error);\n                // 错误处理：让浏览器默认处理\n                return;\n            }\n        }\n    };\n\n    /**\n     * 检查是否为下载链接\n     */\n    function isDownloadLink(url, anchor) {\n        const downloadAttr = anchor ? anchor.getAttribute('download') : null;\n        const fileExtensions = /\\.(apk|zip|rar|exe|dmg|pdf|docx?|xlsx?|pptx?)$/i;\n        \n        return !!downloadAttr || \n               (url && fileExtensions.test(url.pathname)) ||\n               (url && url.pathname.includes('/download/'));\n    }\n\n    /**\n     * 重写window.open（安卓优化版）\n     */\n    const originalOpen = window.open;\n    window.open = function(url, target, features) {\n        console.log('window.open intercepted:', url, target, features);\n\n        // 安卓WebView特殊处理\n        if (isAndroid) {\n            // 检查是否在用户手势上下文中\n            if (isUserGestureContext()) {\n                try {\n                    const urlObj = new URL(url);\n                    \n                    // 下载链接不拦截\n                    if (isDownloadLink(urlObj)) {\n                        return originalOpen.apply(window, arguments);\n                    }\n\n                    // 同一域名链接在当前窗口打开\n                    if (urlObj.origin === window.location.origin) {\n                        location.href = url;\n                        return { closed: false }; // 返回假的窗口对象\n                    }\n                } catch (e) {\n                    console.error('window.open error:', e);\n                }\n            }\n        }\n\n        // 其他情况使用原始方法\n        return originalOpen.apply(window, arguments);\n    };\n\n    /**\n     * 检查是否在用户手势上下文中\n     */\n    function isUserGestureContext() {\n        // 简单检测：检查事件是否由用户直接触发\n        // 实际实现可能需要更复杂的检测\n        return true;\n    }\n\n    /**\n     * 初始化进度条\n     */\n    function initProgressBar() {\n        // 检查是否已有进度条\n        progressContainer = document.querySelector('.gesture-progress-container');\n        if (progressContainer) {\n            progressBar = progressContainer.querySelector('.gesture-progress-bar');\n            return;\n        }\n\n        // 创建进度条容器\n        progressContainer = document.createElement('div');\n        progressContainer.className = 'gesture-progress-container';\n        progressContainer.style.cssText = `\n            position: fixed;\n            bottom: 20px;\n            left: 50%;\n            transform: translateX(-50%);\n            width: 80%;\n            height: 6px;\n            background-color: rgba(0, 0, 0, 0.3);\n            border-radius: 3px;\n            overflow: hidden;\n            z-index: 999999;\n            display: none;\n        `;\n\n        // 创建进度条\n        progressBar = document.createElement('div');\n        progressBar.className = 'gesture-progress-bar';\n        progressBar.style.cssText = `\n            width: 0%;\n            height: 100%;\n            background-color: #4CAF50;\n            transition: width 0.2s ease;\n        `;\n\n        progressContainer.appendChild(progressBar);\n        document.body.appendChild(progressContainer);\n    }\n\n    /**\n     * 更新进度条显示\n     */\n    function updateProgressBar(percentage) {\n        if (!progressBar || !progressContainer) return;\n        \n        const percent = Math.max(0, Math.min(100, percentage));\n        progressBar.style.width = percent + '%';\n        progressContainer.style.display = 'block';\n        \n        // 3秒后自动隐藏\n        clearTimeout(window.progressBarTimeout);\n        window.progressBarTimeout = setTimeout(() => {\n            progressContainer.style.display = 'none';\n        }, 3000);\n    }\n\n    /**\n     * 调整音量\n     */\n    function adjustVolume(delta) {\n        try {\n            // 检查是否在视频或音频上下文中\n            const video = document.querySelector('video');\n            const audio = document.querySelector('audio');\n            \n            if (video && !video.muted) {\n                video.volume = Math.max(0, Math.min(1, video.volume + delta));\n                updateProgressBar(video.volume * 100);\n                showGestureFeedback('音量: ' + Math.round(video.volume * 100) + '%');\n            } else if (audio && !audio.muted) {\n                audio.volume = Math.max(0, Math.min(1, audio.volume + delta));\n                updateProgressBar(audio.volume * 100);\n                showGestureFeedback('音量: ' + Math.round(audio.volume * 100) + '%');\n            } else if (window.Android && typeof window.Android.adjustVolume === 'function') {\n                // 安卓原生音量控制\n                window.Android.adjustVolume(delta);\n                showGestureFeedback('系统音量调整');\n            }\n        } catch (e) {\n            console.error('音量调整失败:', e);\n        }\n    }\n\n    /**\n     * 调整亮度\n     */\n    function adjustBrightness(delta) {\n        try {\n            if (window.Android && typeof window.Android.adjustBrightness === 'function') {\n                // 安卓原生亮度控制\n                window.Android.adjustBrightness(delta);\n                showGestureFeedback('亮度调整');\n            } else {\n                // Web页面亮度调整（CSS滤镜）\n                const currentBrightness = parseFloat(document.documentElement.style.filter.replace('brightness(', '').replace(')', '')) || 1;\n                const newBrightness = Math.max(0.1, Math.min(2, currentBrightness + delta));\n                document.documentElement.style.filter = `brightness(${newBrightness})`;\n                updateProgressBar(newBrightness * 100);\n                showGestureFeedback('亮度: ' + Math.round(newBrightness * 100) + '%');\n            }\n        } catch (e) {\n            console.error('亮度调整失败:', e);\n        }\n    }\n\n    /**\n     * 显示手势反馈\n     */\n    function showGestureFeedback(text) {\n        // 创建反馈元素\n        let feedback = document.querySelector('.gesture-feedback');\n        if (!feedback) {\n            feedback = document.createElement('div');\n            feedback.className = 'gesture-feedback';\n            feedback.style.cssText = `\n                position: fixed;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                background-color: rgba(0, 0, 0, 0.7);\n                color: white;\n                padding: 12px 24px;\n                border-radius: 24px;\n                font-size: 16px;\n                z-index: 999999;\n                opacity: 0;\n                transition: opacity 0.3s ease;\n            `;\n            document.body.appendChild(feedback);\n        }\n\n        feedback.textContent = text;\n        feedback.style.opacity = '1';\n\n        // 2秒后隐藏\n        clearTimeout(window.gestureFeedbackTimeout);\n        window.gestureFeedbackTimeout = setTimeout(() => {\n            feedback.style.opacity = '0';\n        }, 2000);\n    }\n\n    /**\n     * 处理触摸开始事件\n     */\n    function handleTouchStart(e) {\n        if (e.touches.length !== 1) return;\n        \n        gestureStartX = e.touches[0].clientX;\n        gestureStartY = e.touches[0].clientY;\n        gestureStartTime = Date.now();\n        isDragging = false;\n    }\n\n    /**\n     * 处理触摸移动事件\n     */\n    function handleTouchMove(e) {\n        if (e.touches.length !== 1 || isDragging) return;\n        \n        const currentX = e.touches[0].clientX;\n        const currentY = e.touches[0].clientY;\n        const deltaX = currentX - gestureStartX;\n        const deltaY = currentY - gestureStartY;\n        const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);\n        const elapsedTime = Date.now() - gestureStartTime;\n\n        // 检查是否超过阈值\n        if (distance > gestureThreshold && elapsedTime < timeThreshold) {\n            isDragging = true;\n            const absDeltaX = Math.abs(deltaX);\n            const absDeltaY = Math.abs(deltaY);\n            \n            // 区分左右滑动和上下滑动\n            if (absDeltaX > absDeltaY) {\n                // 左右滑动 - 进度条控制\n                const screenWidth = window.innerWidth;\n                const percentage = (currentX / screenWidth) * 100;\n                \n                // 检查是否有视频或音频元素\n                const video = document.querySelector('video');\n                const audio = document.querySelector('audio');\n                \n                if (video && video.duration) {\n                    video.currentTime = (percentage / 100) * video.duration;\n                    updateProgressBar(percentage);\n                    showGestureFeedback('进度: ' + Math.round(percentage) + '%');\n                } else if (audio && audio.duration) {\n                    audio.currentTime = (percentage / 100) * audio.duration;\n                    updateProgressBar(percentage);\n                    showGestureFeedback('进度: ' + Math.round(percentage) + '%');\n                }\n                \n            } else {\n                // 上下滑动 - 音量/亮度控制\n                const screenWidth = window.innerWidth;\n                const touchX = e.touches[0].clientX;\n                \n                // 计算滑动距离比例\n                const deltaRatio = deltaY / window.innerHeight;\n                \n                if (touchX > screenWidth * 0.7) {\n                    // 右边屏幕 - 音量控制\n                    adjustVolume(-deltaRatio * 0.5); // 负号因为向下滑动通常是减小\n                } else if (touchX < screenWidth * 0.3) {\n                    // 左边屏幕 - 亮度控制\n                    adjustBrightness(-deltaRatio * 0.5);\n                }\n            }\n            \n            // 阻止默认行为防止页面滚动\n            e.preventDefault();\n        }\n    }\n\n    /**\n     * 处理触摸结束事件\n     */\n    function handleTouchEnd(e) {\n        isDragging = false;\n    }\n\n    /**\n     * 初始化手势识别\n     */\n    function initGestureRecognition() {\n        // 初始化进度条\n        initProgressBar();\n        \n        // 添加触摸事件监听\n        document.addEventListener('touchstart', handleTouchStart, { passive: true });\n        document.addEventListener('touchmove', handleTouchMove, { passive: false }); // 非passive因为需要preventDefault\n        document.addEventListener('touchend', handleTouchEnd, { passive: true });\n        document.addEventListener('touchcancel', handleTouchEnd, { passive: true });\n        \n        console.log('Gesture recognition initialized');\n    }\n\n    /**\n     * 初始化函数\n     */\n    function init() {\n        // 性能优化：使用事件委托，只在body上监听\n        document.body.addEventListener('click', hookClick, { \n            capture: false, // 安卓推荐使用冒泡阶段\n            passive: true   // 提升滚动性能\n        });\n\n        // 监听base标签变化\n        const observer = new MutationObserver(() => {\n            baseTargetBlank = null; // 清除缓存\n            initCache();\n        });\n\n        observer.observe(document.head, {\n            childList: true,\n            subtree: true\n        });\n\n        // 初始化手势识别\n        initGestureRecognition();\n\n        console.log('Link behavior control with gesture recognition initialized for Android');\n    }\n\n    // 页面加载完成后初始化\n    if (document.readyState === 'complete') {\n        init();\n    } else {\n        document.addEventListener('DOMContentLoaded', init);\n    }\n\n})();","isHtml":false,"htmlPath":"","htmlFiles":[],"prefix":"","pcRepo":"PakePlus-v2.1.3","iosRepo":"PakePlus-iOS-v2.1.3","androidRepo":"PakePlus-Android-v2.1.3","more":{"windows":{"label":"","title":"\tOmnibox","url":"http://mail2.83oouu.top:39221/","userAgent":"Mozilla/5.0 (Linux; Android 14; Pixel 6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Mobile Safari/537.36","width":412,"height":915,"theme":null,"resizable":true,"fullscreen":true,"maximized":false,"minWidth":400,"minHeight":300,"maxWidth":1920,"maxHeight":1080,"decorations":true,"transparent":false,"titleBarStyle":"Visible","visible":true,"focus":true,"closable":true,"minimizable":true,"maximizable":true,"alwaysOnTop":false,"alwaysOnBottom":false,"center":false,"shadow":true,"skipTaskbar":false,"tabbingIdentifier":null,"parent":null,"dragDropEnabled":true,"browserExtensionsEnabled":false,"devtools":true,"contentProtected":false,"hiddenTitle":false,"incognito":false,"proxyUrl":null,"useHttpsScheme":false,"zoomHotkeysEnabled":false,"acceptFirstMouse":false,"create":false,"backgroundColor":null,"backgroundThrottling":null,"javascriptDisabled":false}},"phone":{"safeArea":{"top":0,"bottom":0,"left":0,"right":0},"header":{"show":false,"title":"","backgroundColor":"","color":"","fontSize":16,"fontWeight":"bold","loading":false,"toolBar":false,"toolBarBackgroundColor":"","toolBarColor":"","toolBarFontSize":16,"toolBarFontWeight":"bold"},"siderMenu":{"show":false,"width":0,"backgroundColor":"","color":"","fontSize":16,"fontWeight":"bold","title":"","titleColor":"","titleFontSize":16,"titleFontWeight":"bold"},"tabBar":{"show":false,"backgroundColor":"","color":"","activeColor":"","fontSize":16,"fontWeight":"bold","tabBarItem":[]},"webview":{"userAgent":"","javaScriptEnabled":true,"domStorageEnabled":true,"allowFileAccess":true,"loadWithOverviewMode":true,"setSupportZoom":true,"clearCache":true}},"ios":{"name":"dbaceabfeffd","showName":"Omnibox","version":"0.0.2","webUrl":"http://mail2.83oouu.top:39221/","id":"com.dbaceabfeffd.app.ios","icon":"./app-icon.png","desc":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","pubBody":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","isHtml":false,"debug":false,"safeArea":"top"},"android":{"name":"dbaceabfeffd","showName":"Omnibox","version":"0.0.2","webUrl":"http://mail2.83oouu.top:39221/","id":"com.dbaceabfeffd.app.android","icon":"./app-icon.png","input":"./app-icon.png","output":"./res","rounded":true,"copyTo":"./app/src/main/res","androidResDir":"./app/src/main/res","desc":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","pubBody":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","isHtml":false,"debug":false,"safeArea":"top"},"desktop":{"name":"dbaceabfeffd","showName":"Omnibox","version":"0.0.2","id":"com.dbaceabfeffd.app.desktop","desc":"打包仅限个人使用，请勿传播或商业用途，否则后果自负","webUrl":"http://mail2.83oouu.top:39221/","iconPath":"../app-icon.png","inputPath":"../app-icon.png","tempPath":"./processed-image.png","icnsPath":"../src-tauri/icons/icon.icns","pubBody":"打包仅限个人使用，请勿传播或商业用途，否则后果自负","isHtml":false,"single":true,"state":true,"injectJq":false,"tauriApi":false,"buildMethod":"cloud","debug":false}}